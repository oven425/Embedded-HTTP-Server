<!DOCTYPE html>
<html>
    <head>
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>WebSocket Test</title>
        <style>
            th,td{
                border: 1px solid #ddd;
            }
            tr:nth-child(even) {background-color: #f2f2f2;}
        </style>
    </head>
    <body>
        <div>
             <fieldset>
                 <legend>Location</legend>
                 <div>
                    <!-- <input id="input_url" value="ws://echo.websocket.org"></input> -->
                    <input id="input_url" style="width:300px" value="ws://10.1.1.246:3333/WEBSOCKET_TEST" width="200"></input>
                 </div>
                 <div style="margin:5px 0px 0px 0px">
                    <button id="button_connect" onclick="onconnect()">Connect</button>
                    <button id="button_disconnect" onclick="ondisconnect()">Disconnect</button>
                    <button id="button_ping" onclick="onping()">Ping</button>
                 </div>
             </fieldset>
            <fieldset>
                <legend>Send</legend>
                <div>
                    <label>Message:</label>
                    <input id="input_senddata" type="text" value="send~~"></input>
                    <button id="button_send" onclick="onsend()">Send</button>
                </div>
                <div>
                    <label>File:</label>
                    <input id="input_selectfile" type="file" onchange="onchange_selectfile"></input>
                    <button id="button_sendfile">Send</button>
                </div>
            </fieldset>
            <fieldset>
                <legend>Recv</legend>
                <table style="width:100%">
                    <thead>
                        <th>Time</th>
                        <th>Type</th>
                        <th>Message</th>
                    </thead>
                    <tbody>
                        <tr>
                            <th>AAAA</th>
                            <th>Send-></th>
                            <th>MMMMMMMMMAAAAAAAAAAAAA</th>
                        </tr>
                        <tr>
                            <th>AAAA</th>
                            <th>Send-></th>
                            <th>MMMMMMMMMAAAAAAAAAAAAA</th>
                        </tr>
                        <tr>
                            <th>AAAA</th>
                            <th>Send-></th>
                            <th>MMMMMMMMMAAAAAAAAAAAAA</th>
                        </tr>
                        <tr>
                            <th>AAAA</th>
                            <th>Send-></th>
                            <th>MMMMMMMMMAAAAAAAAAAAAA</th>
                        </tr>
                    </tbody>
                </table>
            </fieldset>
        </div>

        <!-- <div>
            <strong>Log:</strong>
            <br/>
            <div id="consolelog"></div>
            <button id="button_clearlog" onclick="onclearlog()">Clear Log</button>
        </div> -->
        <script>
            function ontablechange(evt, name)
            {

            }
            function onchange_selectfile()
            {
                var file = this.files[0];
                var intput_selectfile = document.getElementById("input_selectfile");
                console.log(file);
            }
            var websocket;
            function onconnect()
            {
                var input_url = document.getElementById("input_url");
                websocket = new WebSocket(input_url.value);
                websocket.onopen=function(evt) { onwebsocketopen(evt) };
                websocket.onclose=function(evt) { onwebsocketclose(evt) };
                websocket.onmessage=function(evt) { onwebsocketrecv(evt) };
            }

            function ondisconnect()
            {
                websocket.close();
            }

            function onping()
            {
                websocket.ping('', false, true);
            }

            function onsend()
            {
                var aa = document.getElementById("input_senddata");
                console.log(aa.value);
                websocket.send(aa.value);
            }

            function onwebsocketrecv(evt)
            {
                var consoleLog = document.getElementById("consolelog");
                var p = document.createElement('p');
                p.style.wordWrap = 'break-word';
                p.innerText=evt.data;

                consoleLog.appendChild(p);

                while (consoleLog.childNodes.length > 50)
                {
                    consoleLog.removeChild(consoleLog.firstChild);
                }

                consoleLog.scrollTop = consoleLog.scrollHeight;
            }

            function onwebsocketclose(evt)
            {
                var consoleLog = document.getElementById("consolelog");
                var p = document.createElement('p');
                p.style.wordWrap = 'break-word';
                p.innerText="DisConnect";

                consoleLog.appendChild(p);

                while (consoleLog.childNodes.length > 50)
                {
                consoleLog.removeChild(consoleLog.firstChild);
                }

                consoleLog.scrollTop = consoleLog.scrollHeight;
            }

            function onwebsocketopen(evt)
            {
                var consoleLog = document.getElementById("consolelog");
                var p = document.createElement('p');
                p.style.wordWrap = 'break-word';
                p.innerText="Connect";

                consoleLog.appendChild(p);

                while (consoleLog.childNodes.length > 50)
                {
                consoleLog.removeChild(consoleLog.firstChild);
                }

                consoleLog.scrollTop = consoleLog.scrollHeight;
            }

            function onclearlog()
            {
                var consoleLog = document.getElementById("consolelog");

                // As long as <ul> has a child node, remove it
                while (consoleLog.hasChildNodes()) {   
                    consoleLog.removeChild(consoleLog.firstChild);
                }
            }
       </script>
    </body>
</html>
