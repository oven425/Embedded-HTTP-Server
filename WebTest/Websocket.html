<!DOCTYPE html>
<html>
    <head>
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>WebSocket Test</title>
        <style>
            /* th,td{
                border: 1px solid #ddd;
            } */
            tr:nth-child(even) {background-color: #f2f2f2;}
        </style>
    </head>
    <body>
        <div>
             <fieldset>
                 <legend>Location</legend>
                 <div>
                    <!-- <input id="input_url" value="ws://echo.websocket.org"></input> -->
                    <input id="input_url" style="width:100%" value="ws://10.1.1.246:3333/WEBSOCKET_TEST" width="200"></input>
                 </div>
                 <div style="margin:5px 0px 0px 0px">
                    <button id="button_connect" onclick="onconnect()">Connect</button>
                    <button id="button_disconnect" onclick="ondisconnect()">Disconnect</button>
                    <button id="button_ping" onclick="onping()">Ping</button>
                 </div>
             </fieldset>
            <fieldset>
                <legend>Send</legend>
                <div>
                    <label>Message:</label>
                    <input id="input_senddata" type="text" value="send~~"></input>
                    <button id="button_send" onclick="onsend()">Send</button>
                </div>
                <div>
                    <label>File:</label>
                    <input id="input_selectfile" type="file" onchange="onchange_selectfile"></input>
                    <button id="button_sendfile">Send</button>
                </div>
            </fieldset>
            <fieldset>
                <legend>Recv</legend>
                <table id="table_logs" style="width:100%">
                    <thead>
                        <td>Time</td>
                        <td>Type</td>
                        <td>Message</td>
                    </thead>
                    <tbody>
                        
                    </tbody>
                </table>
            </fieldset>
        </div>
        <script>
            function ontablechange(evt, name)
            {

            }
            function onchange_selectfile()
            {
                var file = this.files[0];
                var intput_selectfile = document.getElementById("input_selectfile");
                console.log(file);
            }
            var websocket;
            function onconnect()
            {
                var input_url = document.getElementById("input_url");
                websocket = new WebSocket(input_url.value);
                websocket.binaryType = "arraybuffer";
                websocket.onopen=function(evt) { onwebsocketopen(evt) };
                websocket.onclose=function(evt) { onwebsocketclose(evt) };
                websocket.onmessage=function(evt) { onwebsocketrecv(evt) };
            }

            function ondisconnect()
            {
                websocket.close();
            }

            function onping()
            {
                websocket.ping('', false, true);
            }

            function onsend()
            {
                var aa = document.getElementById("input_senddata");
                console.log(aa.value);
                AddTable("Send", aa.value);
                websocket.send(aa.value);
            }

            function AddTable(type, message){
                var table = document.getElementById("table_logs");
                var row = table.insertRow(1);
                var cell_time = row.insertCell(0);
                var cell_type = row.insertCell(1);
                var cell_message = row.insertCell(2);
                var dt = new Date();
                var year = dt.getFullYear();
                var month = dt.getMonth()+1;
                var day = dt.getDay();
                var hour = dt.getHours();
                var min = dt.getMinutes();
                var sec = dt.getSeconds();
                cell_time.innerHTML = year+"/"+month+"/"+day+" "+hour+":"+min+":"+sec;
                cell_type.innerHTML =  type;
                cell_message.innerHTML =  message;


            }

            

            function onwebsocketrecv(evt)
            {
                AddTable("Recv", evt.data);
                // var consoleLog = document.getElementById("consolelog");
                // var p = document.createElement('p');
                // p.style.wordWrap = 'break-word';
                // p.innerText=evt.data;

                // consoleLog.appendChild(p);

                // while (consoleLog.childNodes.length > 50)
                // {
                //     consoleLog.removeChild(consoleLog.firstChild);
                // }

                // consoleLog.scrollTop = consoleLog.scrollHeight;
            }

            function onwebsocketclose(evt)
            {
                var consoleLog = document.getElementById("consolelog");
                var p = document.createElement('p');
                p.style.wordWrap = 'break-word';
                p.innerText="DisConnect";

                consoleLog.appendChild(p);

                while (consoleLog.childNodes.length > 50)
                {
                consoleLog.removeChild(consoleLog.firstChild);
                }

                consoleLog.scrollTop = consoleLog.scrollHeight;
            }

            function onwebsocketopen(evt)
            {
                AddTable("State", "Connect");
                // var consoleLog = document.getElementById("consolelog");
                // var p = document.createElement('p');
                // p.style.wordWrap = 'break-word';
                // p.innerText="Connect";

                // consoleLog.appendChild(p);

                // while (consoleLog.childNodes.length > 50)
                // {
                // consoleLog.removeChild(consoleLog.firstChild);
                // }

                // consoleLog.scrollTop = consoleLog.scrollHeight;
            }

            function onclearlog()
            {
                var consoleLog = document.getElementById("consolelog");

                // As long as <ul> has a child node, remove it
                while (consoleLog.hasChildNodes()) {   
                    consoleLog.removeChild(consoleLog.firstChild);
                }
            }
       </script>
    </body>
</html>
