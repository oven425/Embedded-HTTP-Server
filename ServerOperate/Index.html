<html>
    <head>
        <title>Server web</title>
        <style>
            .grid{
                display: grid;
                grid-template-columns: 200px auto;
                height: 100%;
            }
            .main_control{
                background-color: lightblue;
            }
            .sub_control
            {
                background-color: wheat;
            }
            .acceptor{
                margin-bottom: 3px;
            }
            .acceptor_address{
                display: inline-block;
                font-family: Arial, Helvetica, sans-serif;
                font-size: 14;
                vertical-align: middle;
            }
            .acceptor_state{
                display: inline-block;
                width: 25px;
                height: 25px;
                border-radius: 5px;
                border: 10px, black;
                vertical-align: middle;
            }
            .acceptor_state_fail{
                background-color:red;
            }
            .acceptor_state_close{
                background-color:gray;
            }
            .acceptor_state_opening{
                background-color:orange;
            }
            .acceptor_state_normal{
                background-color:green;
            }
        </style>
    </head>
    <body onload="myFunction()">
        <div class="grid">
            <div class="main_control">
                <div id="time"> </div>
                <div onclick="OnMethodList()">Method list</div>
                <div id="ll">Acceptor</div>
                <div id="accepts">
                    <!-- <div class="acceptor">
                        <div class="acceptor_state"></div>
                        <div class="acceptor_address">127.0.0.1:3333</div>
                    </div>
                    <div class="acceptor">
                        <div class="acceptor_state"></div>
                        <div class="acceptor_address">127.0.0.1:3333</div>
                    </div>
                    <div class="acceptor">
                        <div class="acceptor_state"></div>
                        <div class="acceptor_address">127.0.0.1:3333</div>
                    </div> -->
                </div>
            </div>
            <div id="sub_control" class="sub_control">
                <div>
                    <table id="table_methods">
                        <thead>
                            <th>Method</th>
                            <th>Type</th>
                        </thead>
                        <tbody>
                            
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
    <script type="text/javascript">
        function OnMethodList(){
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var vv = document.getElementById("sub_control");
                    
                    var vv = JSON.parse(this.responseText);
                    var table = document.getElementById("table_methods");

                    while(table.rows.length > 1)
                    {
                        table.deleteRow(1);
                    }
                    for(var i=0 ; i<vv.length ; i++)
                    {
                        var row = table.insertRow();
                        var cell_1 = row.insertCell(0);
                        cell_1.innerHTML = vv[i].Url;
                        var cell_2 = row.insertCell(1);
                        cell_2.innerHTML = vv[i].LifeType==1?"Singleton":"Transient";
                    }
                }
            };
            xhttp.open("GET", "http://10.1.1.246:3333/web/GetRouters", true);
            xhttp.send();
        }
        function myFunction(){
            setInterval(Timer1, 1000);
        }

        function update_acceptor(){
        var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var vv = JSON.parse(this.responseText);
                    var tt = "";
                    for(var i=0 ; i<vv.length ; i++)
                    {
                        tt = tt+"<div class=\"acceptor\">";
                        var state = "acceptor_state";
                        switch(vv[i].ListenState)
                        {
                            case 1:{
                                state = state + " " + "acceptor_state_close";
                            }
                            break;
                            case 2:{
                                state = state + " " + "acceptor_state_opening";
                            }
                            break;
                            case 3:{
                                state = state + " " + "acceptor_state_fail";
                            }
                            break;
                            case 4:{
                                state = state + " " + "acceptor_state_normal";
                            }
                            break;
                        }
                        tt = tt + "<div class=\""+state+"\"></div>";
                        tt = tt + "<div class=\"acceptor_address\">"+vv[i].Address.IP+":"+vv[i].Address.Port+"</div>";
                        tt = tt +"</div>";
                    }

                    var aac = document.getElementById("accepts");
                    if(aac.innerHTML != tt)
                    {
                        aac.innerHTML = tt;
                    }
                }
            };
            xhttp.open("GET", "http://10.1.1.246:3333/web/GetAccepters", true);
            xhttp.send();
        }
        function Timer1(){
            update_acceptor();
            var time = document.getElementById("time");
            var datetime = new Date();
            time.innerHTML = datetime.getFullYear()+"/"+datetime.getMonth()+1+"/"+datetime.getDay() + " "+datetime.getHours()+":"+datetime.getMinutes()+":"+datetime.getSeconds();
        }

    </script>
            
    </body>
</html>